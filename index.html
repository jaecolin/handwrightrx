<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>林佑彥醫師 - 水煎藥處方生成器 (ICD萬用擴充版 v16)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 引入 Google Fonts：明體 (Noto Serif TC)、黑體 (Noto Sans TC) -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        /* 字體類別設定 */
        .font-ming {
            font-family: 'Noto Serif TC', 'PMingLiU', 'MingLiU', serif !important;
        }
        
        .font-hei {
            font-family: 'Noto Sans TC', 'Microsoft JhengHei', 'PingFang TC', sans-serif !important;
        }
        
        /* 嚴格的 A4 列印設定：確保單頁不溢出 */
        @page {
            size: A4 portrait;
            margin: 0; 
        }
        
        @media print {
            .no-print { display: none !important; }
            body { 
                background: white; 
                margin: 0; 
                padding: 0; 
                -webkit-print-color-adjust: exact;
            }
            #print-area { 
                box-shadow: none !important; 
                margin: 0 !important; 
                width: 210mm !important; 
                height: 297mm !important; 
                padding: 12mm 15mm !important; /* 縮減列印邊界，爭取更多內容空間 */
                box-sizing: border-box !important;
                page-break-after: avoid !important;
                page-break-inside: avoid !important;
                overflow: hidden !important; /* 強制不溢出 */
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 font-ming">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const CLINIC_INFO = {
            nameZh: "祥峻中醫診所",
            address: "台中市西屯區市政北一路1號6樓之1",
            phone: "04-2473-5561",
            physician: "林佑彥 醫師",
            license: "台中字第010625號"
        };

        const LOCAL_ICD_DICT = {
            // --- 眼科與內科常用備註 (原設定保留) ---
            "H04.123": "乾眼症 (雙眼)",
            "H04.121": "乾眼症 (右眼)",
            "H04.122": "乾眼症 (左眼)",
            "H43.39": "飛蚊症 (其他玻璃體混濁)",
            "H35.81": "視網膜水腫",
            "H52.1": "近視",
            "H52.4": "老花眼",
            "E11.9": "第二型糖尿病",
            "I10": "原發性高血壓",
            "G47.00": "失眠",
            "G47.9": "睡眠障礙",
            "F41.9": "焦慮症",
            "F32.9": "憂鬱症",
            "R53.83": "疲倦",

            // --- 新增擴充病名清單 ---
            "B00.0": "疱疹性濕疹",
            "B00.50": "疱疹病毒性眼疾病",
            "B00.52": "疱疹病毒性角膜炎",
            "B00.9": "疱疹病毒感染",
            "B02.23": "疱疹後多發神經病變",
            "B02.29": "疱疹後侵及其他神經系統",
            "B02.30": "帶狀疱疹眼病",
            "B02.32": "帶狀疱疹性虹膜睫狀體炎",
            "B02.33": "帶狀疱疹性角膜炎",
            "B02.8": "帶狀疱疹伴有其他併發症",
            "B02.9": "帶狀疱疹未伴有併發症",
            "B08.5": "腸病毒性囊泡性咽炎",
            "B10.89": "人類其他疱疹病毒感染",
            "B18.1": "慢性病毒性B型肝炎未伴有D 型肝炎病毒",
            "B18.2": "慢性病毒性C型肝炎",
            "B26.9": "其他流行性腮腺炎未伴有併發症",
            "B30.0": "腺病毒所致之角膜結膜炎",
            "B35.1": "甲癬",
            "C09.9": "扁桃腺惡性腫瘤",
            "C20": "直腸惡性腫瘤",
            "C22.0": "肝細胞癌",
            "C34.11": "上葉之右側支氣管或肺惡性腫瘤",
            "C34.12": "上葉之左側支氣管或肺惡性腫瘤",
            "C34.80": "未明示側性支氣管及肺重疊部位之惡性腫瘤",
            "C34.90": "未明示側性支氣管或肺惡性腫瘤",
            "C50.211": "女性右側乳房內上四分之一惡性腫瘤",
            "C50.311": "女性右側乳房內下四分之一惡性腫瘤",
            "C50.411": "女性右側乳房外上四分之一惡性腫瘤",
            "C50.412": "女性左側乳房外上四分之一惡性腫瘤",
            "C50.512": "女性左側乳房外下四分之一惡性腫瘤",
            "C50.919": "女性乳房未明示部位惡性腫瘤",
            "C61": "攝護腺惡性腫瘤",
            "C73": "甲狀腺惡性腫瘤",
            "C81.90": "未明示部位之何杰金淋巴瘤",
            "C83.31": "頭,臉及頸部淋巴結之瀰漫性巨大B-細胞淋巴瘤",
            "C92.A0": "急性骨髓性白血病伴有多系發育不全,未達到緩解",
            "D05.90": "未明示側性乳房原位癌",
            "D13.4": "肝臟良性腫瘤",
            "D18.03": "腹內血管瘤",
            "D22.11": "右側眼臉(含眼角)黑色素細胞痣",
            "D25.0": "子宮黏膜下層平滑肌瘤",
            "D25.1": "子宮壁內平滑肌瘤",
            "D25.9": "子宮平滑肌瘤",
            "D31.92": "左側眼睛良性腫瘤",
            "D33.0": "大腦天幕上良性腫瘤",
            "D33.2": "腦良性腫瘤",
            "D35.2": "腦下腺良性腫瘤",
            "D56.9": "地中海型貧血",
            "D64.9": "貧血",
            "D89.89": "涉及免疫機轉的其他特定疾患,他處未歸類者",
            "E03.9": "甲狀腺低下",
            "E04.9": "非毒性甲狀腺腫",
            "E05.00": "毒性瀰漫性甲狀腺腫,未伴有甲狀腺毒性危象或風暴",
            "E05.90": "未明示之甲狀腺毒症,未伴有甲狀腺毒性危象或風暴",
            "E06.9": "甲狀腺炎",
            "E07.9": "甲狀腺疾患",
            "E08.311": "起因於潛在病的糖尿病,伴有糖尿病的視網膜病變,伴有黃斑部水腫",
            "E10.9": "第一型糖尿病,未伴有併發症",
            "E11.21": "第二型糖尿病,伴有糖尿病的腎臟病變",
            "E11.311": "第二型糖尿病,伴有糖尿病的視網膜病變,伴有黃斑部水腫",
            "E11.319": "第二型糖尿病,伴有糖尿病的視網膜病變,未伴有黃斑部水腫",
            "E11.321": "第二型糖尿病,伴有輕度糖尿病的非增殖型視網膜病變,伴有黃斑部水腫",
            "E11.3219": "第二型糖尿病,未明示側性伴有輕度糖尿病的非增殖型視網膜病變,伴有黃斑部水腫",
            "E11.329": "第二型糖尿病,伴有輕度糖尿病的非增殖型視網膜病變,未伴有黃斑部水腫",
            "E11.331": "第二型糖尿病,伴有中度糖尿病的非增殖型視網膜病變,伴有黃斑部水腫",
            "E11.339": "第二型糖尿病,伴有中度糖尿病的非增殖型視網膜病變,未伴有黃斑部水腫",
            "E11.351": "第二型糖尿病,伴有糖尿病的增殖型視網膜病變,伴有黃斑部水腫",
            "E11.3513": "第二型糖尿病,雙眼伴有糖尿病的增殖型視網膜病變,伴有黃斑部水腫",
            "E11.3519": "第二型糖尿病,未明示側性伴有糖尿病的增殖型視網膜病變,伴有黃斑部水腫",
            "E11.359": "第二型糖尿病,伴有糖尿病的增殖型視網膜病變,未伴有黃斑部水腫",
            "E11.3592": "第二型糖尿病,左眼伴有糖尿病的增殖型視網膜病變,未伴有黃斑部水腫",
            "E11.3593": "第二型糖尿病,雙眼伴有糖尿病的增殖型視網膜病變,未伴有黃斑部水腫",
            "E11.3599": "第二型糖尿病,未明示側性伴有糖尿病的增殖型視網膜病變,未伴有黃斑部水腫",
            "E11.40": "第二型糖尿病,伴有糖尿病的神經病變",
            "E11.65": "第二型糖尿病,伴有高血糖",
            "E11.69": "第二型糖尿病,伴有其他特定併發症",
            "E11.8": "第二型糖尿病,伴有未明示之併發症",
            "E13.22": "其他特定糖尿病,糖尿病的慢性腎臟疾病",
            "E13.311": "其他特定糖尿病,伴有糖尿病的視網膜病變,伴有黃斑部水腫",
            "E13.8": "其他特定糖尿病,伴有未明示之併發症",
            "E13.9": "其他特定糖尿病,未伴有併發症",
            "E28.2": "多囊性卵巢症候群",
            "E30.1": "青春期過早",
            "E78.0": "純高膽固醇血症",
            "E78.4": "其他高血脂症",
            "E78.5": "高血脂症",
            "E83.00": "銅代謝疾患",
            "E89.3": "手術後腦下腺低下",
            "F03.90": "失智症,未明示嚴重度,未伴有行為障礙",
            "F06.8": "已知生理狀況引起的其他特定精神疾病",
            "F20.0": "妄想型思覺失調症",
            "F20.81": "類思覺失調性疾患",
            "F20.9": "非特定的思覺失調",
            "F30.2": "有精神病症狀的躁症發作,重度",
            "F34.1": "持續性憂鬱症",
            "F41.0": "特定場所畏懼症的恐慌症",
            "F41.1": "廣泛性焦慮症",
            "F41.3": "其他混合型焦慮症",
            "F41.8": "其他特定的焦慮症",
            "F43.23": "有混合焦慮及憂鬱情緒的適應障礙症",
            "F51.02": "適應性失眠症",
            "F51.09": "非物質或已知生理狀況引起的其他失眠症",
            "F51.12": "睡眠不足症候群",
            "F51.8": "非物質或已知生理狀況引起的其他睡眠障礙症",
            "F51.9": "非物質或已知生理狀況引起的非特定的睡眠障礙症",
            "F90.9": "注意力不足過動症,非特定型",
            "F95.2": "妥瑞氏症",
            "F98.0": "非物質或已知生理狀況引起的遺尿症",
            "G08": "顱內及脊椎管內靜脈炎及血栓靜脈炎",
            "G12.20": "運動神經元疾病",
            "G12.21": "肌萎縮性側索硬化症",
            "G20": "巴金森氏症",
            "G21.4": "血管性巴金森氏症",
            "G24.5": "眼瞼痙攣",
            "G32.81": "歸類於他處疾病所致之小腦性運動失調",
            "G43.009": "無預兆偏頭痛,非頑固性,未伴有偏頭痛重積狀態",
            "G43.109": "預兆偏頭痛,非頑固性,未伴有偏頭痛重積狀態",
            "G43.111": "預兆偏頭痛,頑固性,伴有偏頭痛重積狀態",
            "G43.701": "慢性無預兆偏頭痛,非頑固性,伴有偏頭痛重積狀態",
            "G43.901": "偏頭痛,未明確定義型態,非頑固性,伴有偏頭痛重積狀態",
            "G43.909": "偏頭痛,未明確定義型態,非頑固性,未伴有偏頭痛重積狀態",
            "G43.919": "偏頭痛,未明確定義型態,頑固性,未伴有偏頭痛重積狀態",
            "G44.029": "慢性叢發性頭痛,非頑固性",
            "G44.051": "短暫單側神經痛性頭痛發作伴有結膜充血及流淚(SUNCT),頑固性",
            "G44.209": "緊縮型頭痛,未明確定義型態,非頑固性",
            "G44.229": "慢性緊縮型頭痛,非頑固性",
            "G44.51": "持續性半邊頭痛",
            "G47.09": "其他失眠症",
            "G47.30": "非特定的睡眠呼吸中止",
            "G47.33": "阻塞性睡眠呼吸中止 (成人) (小兒)",
            "G47.8": "其他睡眠障礙症",
            "G50.0": "三叉神經痛",
            "G51.0": "Bell 氏麻痺",
            "G51.9": "顏面神經疾患",
            "G70.00": "重症肌無力未伴有急性惡化",
            "G80.8": "其他腦性麻痺",
            "G98.8": "神經系統其他疾患",
            "H00.0": "麥粒腫",
            "H00.011": "右側上眼瞼外麥粒腫",
            "H00.013": "右側眼未明示上、下眼瞼外麥粒腫",
            "H00.014": "左側上眼瞼外麥粒腫",
            "H00.019": "未明示左側、右側眼之眼瞼外麥粒腫,未明示上或下眼瞼",
            "H00.022": "右側下眼瞼內麥粒腫",
            "H00.024": "左側上眼瞼內麥粒腫",
            "H00.039": "未明示左側、右側眼瞼及上或下眼瞼膿瘍",
            "H00.1": "霰粒腫",
            "H00.12": "右側下眼瞼霰粒腫",
            "H00.13": "右側眼霰粒腫,未明示上或下眼瞼",
            "H00.14": "左側上眼瞼霰粒腫",
            "H00.15": "左側下眼瞼霰粒腫",
            "H00.16": "左側眼霰粒腫,未明示上或下眼瞼",
            "H00.19": "未明示左側、右側眼及上或下眼瞼霰粒腫",
            "H01.0": "眼瞼炎",
            "H02.0": "瞼內翻",
            "H02.1": "瞼外翻",
            "H02.202": "右側下眼瞼兔眼",
            "H02.206": "左側眼之兔眼,未明示上或下眼瞼",
            "H02.4": "眼瞼下垂",
            "H02.60": "未明示左側、右側眼及上或下之眼瞼黃斑瘤",
            "H02.9": "眼瞼疾患",
            "H04.002": "左側淚腺炎",
            "H04.1": "乾眼症",
            "H04.129": "未明示側性之淚腺乾眼症",
            "H04.2": "淚溢",
            "H04.202": "左側溢淚",
            "H04.203": "雙側溢淚",
            "H04.209": "未明示側性之溢淚",
            "H04.412": "左側淚道慢性淚囊炎",
            "H04.551": "後天性右側鼻淚管狹窄",
            "H04.559": "後天性未明示側性之鼻淚管狹窄",
            "H04.89": "淚器系之其他疾患",
            "H04.9": "淚器系疾患",
            "H05.10": "眼窩慢性炎症",
            "H05.129": "未明示側性之眼窩眼肌炎",
            "H05.20": "眼球突出",
            "H05.89": "眼窩之其它疾患",
            "H05.9": "眼窩疾患",
            "H10.0": "結膜炎",
            "H10.1": "急性異位性結膜炎",
            "H10.32": "左側眼急性結膜炎",
            "H10.402": "左側眼慢性結膜炎",
            "H10.403": "雙側眼慢性結膜炎",
            "H10.409": "未明示側性之慢性結膜炎",
            "H10.419": "未明示側性之慢性巨大乳頭狀結膜炎",
            "H10.45": "其他慢性過敏性結膜炎",
            "H10.503": "雙側眼瞼結膜炎",
            "H10.509": "未明示側性之眼瞼結膜炎",
            "H10.9": "結膜炎",
            "H11.0": "翼狀胬肉",
            "H11.003": "雙側眼翼狀贅肉",
            "H11.009": "未明示側性之翼狀贅肉",
            "H11.123": "雙側眼結膜結石",
            "H11.129": "未明示側性之結膜結石",
            "H11.149": "未明示側性之結膜乾燥症",
            "H11.30": "未明示側性之結膜出血",
            "H11.32": "左側眼結膜出血",
            "H11.422": "左側眼結膜水腫",
            "H11.429": "未明示側性之結膜水腫",
            "H15.001": "右側眼鞏膜炎",
            "H15.002": "左側眼鞏膜炎",
            "H15.003": "雙側眼鞏膜炎",
            "H15.009": "未明示側性之鞏膜炎",
            "H15.049": "未明示側性之侵及角膜的鞏膜炎",
            "H15.101": "右側眼上鞏膜炎",
            "H15.102": "左側眼上鞏膜炎",
            "H15.109": "未明示側性之上鞏膜炎",
            "H16.0": "角膜潰瘍",
            "H16.001": "右側眼角膜潰瘍",
            "H16.002": "左側眼角膜潰瘍",
            "H16.009": "未明示側性之角膜潰瘍",
            "H16.1": "結膜角膜炎",
            "H16.102": "左側眼表層角膜炎",
            "H16.109": "未明示側性之表層角膜炎",
            "H16.123": "雙側眼絲狀性角膜炎",
            "H16.141": "右側眼點狀角膜炎",
            "H16.223": "雙側眼乾性角膜結膜炎,未明示為Sjoren氏徵候群",
            "H16.229": "未明示側性之乾性角膜結膜炎,未明示為Sjoren氏徵候群",
            "H16.233": "雙側眼神經失養性角膜結膜炎",
            "H16.312": "左側眼角膜膿瘍",
            "H16.402": "左側眼角膜新生血管",
            "H16.9": "角膜炎",
            "H17.89": "其它角膜瘢痕和混濁",
            "H17.9": "角膜瘢痕和混濁",
            "H18.0": "角膜色素沉著",
            "H18.20": "角膜水腫",
            "H18.50": "遺傳性角膜失養症",
            "H18.502": "左側遺傳性角膜失養症",
            "H18.509": "遺傳性角膜失養症,未明示側性",
            "H18.51": "角膜內皮失養症",
            "H18.519": "角膜內皮失養症,未明示側性",
            "H18.59": "其他遺傳性角膜失養症",
            "H18.601": "右側眼圓錐狀角膜",
            "H18.609": "未明示側性之圓錐狀角膜",
            "H18.823": "雙側眼因配帶隱形眼鏡造成之角膜疾患",
            "H18.9": "角膜疾患",
            "H20.0": "急性及亞急性虹膜睫狀體炎",
            "H20.00": "急性及亞急性虹膜睫狀體炎",
            "H20.019": "未明示側性之原發性虹膜睫狀體炎",
            "H20.029": "未明示側性之復發性急性虹膜睫狀體炎",
            "H20.9": "虹膜睫狀體炎",
            "H21.02": "左側眼前房出血",
            "H25.0": "老年性初發性白內障",
            "H25.13": "雙側核性老年性白內障",
            "H25.9": "老年性白內障, 未明示",
            "H26.0": "嬰兒、少年和初老性白內障",
            "H26.9": "白內障, 未明示",
            "H30.0": "局限性脈絡膜視網膜發炎",
            "H30.003": "雙側局限性脈絡膜視網膜發炎",
            "H30.009": "未明示側性局限性脈絡膜視網膜發炎",
            "H30.109": "未明示側性瀰漫性脈絡膜視網膜炎",
            "H30.813": "雙側原田氏病",
            "H30.819": "未明示側性原田氏病",
            "H30.891": "右側眼其他脈絡膜視網膜發炎",
            "H30.892": "左側眼其他脈絡膜視網膜發炎",
            "H30.90": "未明示側性脈絡膜視網膜發炎",
            "H30.93": "雙側脈絡膜視網膜發炎",
            "H31.011": "右側眼後極部黃斑疤痕(發炎後)(創傷後)",
            "H31.109": "未明示側性脈絡膜退化",
            "H33.0": "視網膜剝離伴有視網膜裂孔",
            "H33.001": "右側眼視網膜剝離併視網膜裂孔",
            "H33.002": "左側眼視網膜剝離併視網膜裂孔",
            "H33.003": "雙側視網膜剝離併視網膜裂孔",
            "H33.009": "未明示側性視網膜剝離併視網膜裂孔",
            "H33.012": "左側眼視網膜剝離伴有單一裂孔",
            "H33.021": "右側眼視網膜剝離伴有多數裂孔",
            "H33.022": "左側眼視網膜剝離伴有多數裂孔",
            "H33.032": "左側眼視網膜剝離伴有巨大視網膜裂孔",
            "H33.052": "左側眼全部視網膜剝離",
            "H33.103": "雙側視網膜層分裂",
            "H33.20": "未明示側性漿液性視網膜剝離",
            "H33.21": "右側眼漿液性視網膜剝離",
            "H33.22": "左側眼漿液性視網膜剝離",
            "H33.301": "右側眼視網膜裂孔",
            "H33.302": "左側眼視網膜裂孔",
            "H33.303": "雙側視網膜裂孔",
            "H33.309": "未明示側性視網膜裂隙",
            "H33.312": "左側眼網膜馬蹄型裂孔,未伴有剝離",
            "H33.319": "未明示側性網膜馬蹄型裂孔,未伴有剝離",
            "H33.321": "右側眼網膜圓型裂孔",
            "H33.322": "左側眼網膜圓型裂孔",
            "H33.323": "雙側網膜圓型裂孔",
            "H33.329": "未明示側性網膜圓型裂孔",
            "H33.8": "其他視網膜剝離",
            "H34.10": "未明示側性中心視網膜動脈阻塞",
            "H34.11": "右側眼中心視網膜動脈阻塞",
            "H34.811": "右側眼中心視網膜靜脈阻塞",
            "H34.8110": "右側中心視網膜靜脈阻塞,伴有黃斑部水腫",
            "H34.8112": "右側中心視網膜靜脈阻塞,穩定狀況",
            "H34.812": "左側眼中心視網膜靜脈阻塞",
            "H34.8120": "左側中心視網膜靜脈阻塞,伴有黃斑部水腫",
            "H34.8122": "左側中心視網膜靜脈阻塞,穩定狀況",
            "H34.819": "未明示側性中心視網膜靜脈阻塞",
            "H34.8192": "未明示側性中心視網膜靜脈阻塞,穩定狀況",
            "H34.831": "右側眼視網膜靜脈支流（分枝）阻塞",
            "H34.8310": "右側視網膜靜脈支流(分枝)阻塞,伴有黃斑部水腫",
            "H34.8311": "右側視網膜靜脈支流(分枝)阻塞,伴有新生血管",
            "H34.8312": "右側視網膜靜脈支流(分枝)阻塞,穩定狀況",
            "H34.832": "左側眼視網膜靜脈支流（分枝）阻塞",
            "H34.8320": "左側視網膜靜脈支流(分枝)阻塞,伴有黃斑部水腫",
            "H34.833": "雙側視網膜靜脈支流（分枝）阻塞",
            "H34.839": "未明示側性視網膜靜脈支流（分枝）阻塞",
            "H35.0": "背景視網膜病變",
            "H35.00": "背景性視網膜病變",
            "H35.013": "雙側視網膜血管型態之變化",
            "H35.021": "右側眼滲出性視網膜病變",
            "H35.022": "左側眼滲出性視網膜病變",
            "H35.031": "右側眼高血壓性視網膜病變",
            "H35.042": "左側眼視網膜微動脈瘤",
            "H35.051": "右側眼視網膜血管新生",
            "H35.052": "左側眼視網膜血管新生",
            "H35.053": "雙側眼視網膜血管新生",
            "H35.059": "未明示側性視網膜血管新生",
            "H35.09": "其他視網膜內微血管異常",
            "H35.109": "未明示側性早產性視網膜病變",
            "H35.3": "黃斑部變性",
            "H35.30": "黃斑部退化",
            "H35.31": "老年性非滲出性黃斑退化",
            "H35.3130": "雙側老年性非滲出性黃斑退化,未明示期別",
            "H35.32": "老年性滲出性黃斑退化",
            "H35.3210": "右側老年性滲出性黃斑退化,未明示期別",
            "H35.3211": "右側老年性滲出性黃斑退化,伴有活動性脈絡膜新生血管",
            "H35.3220": "左側老年性滲出性黃斑退化,未明示期別",
            "H35.3230": "雙側老年性滲出性黃斑退化,未明示期別",
            "H35.3233": "雙側老年性滲出性黃斑退化,伴有不活動性疤痕",
            "H35.3290": "老年性滲出性黃斑退化,未明示期別,未明示側性",
            "H35.3293": "老年性滲出性黃斑退化,伴有不活動性疤痕,未明示側性",
            "H35.341": "右側眼黃斑部囊腫,破洞或假性破洞",
            "H35.342": "左側眼黃斑部囊腫,破洞或假性破洞",
            "H35.343": "雙側黃斑部囊腫,破洞或假性破洞",
            "H35.349": "未明示側性黃斑部囊腫,破洞或假性破洞",
            "H35.351": "右側眼黃斑部囊狀退化",
            "H35.352": "左側眼黃斑部囊狀退化",
            "H35.359": "未明示側性黃斑部囊狀退化",
            "H35.369": "未明示側性黃斑部疣（退化）",
            "H35.371": "右側眼黃斑部皺褶",
            "H35.372": "左側眼黃斑部皺褶",
            "H35.373": "雙側黃斑部皺褶",
            "H35.379": "未明示側性黃斑部皺褶",
            "H35.40": "周邊視網膜退化",
            "H35.411": "右側眼視網膜格子狀退化",
            "H35.412": "左側眼視網膜格子狀退化",
            "H35.413": "雙側視網膜格子狀退化",
            "H35.419": "未明示側性視網膜格子狀退化",
            "H35.431": "右側眼視網膜鋪路石狀退化",
            "H35.50": "遺傳性視網膜失養症",
            "H35.52": "色素性視網膜失養症",
            "H35.53": "其他涉及感覺網膜之視網膜失養症",
            "H35.54": "涉及網膜色素上皮之失養症",
            "H35.60": "未明示側性視網膜出血",
            "H35.61": "右側眼視網膜出血",
            "H35.62": "左側眼視網膜出血",
            "H35.63": "雙側視網膜出血",
            "H35.711": "右側眼中心漿液性脈絡視網膜病變",
            "H35.712": "左側眼中心漿液性脈絡視網膜病變",
            "H35.713": "雙側中心漿液性脈絡視網膜病變",
            "H35.719": "未明示側性中心漿液性脈絡視網膜病變",
            "H35.89": "其他特定視網膜疾患",
            "H35.9": "視網膜疾患",
            "H36.0": "糖尿病性視網膜病變",
            "H40.001": "右側眼前青光眼",
            "H40.002": "左側眼前青光眼",
            "H40.003": "雙側眼前青光眼",
            "H40.009": "未明示側性前青光眼",
            "H40.043": "雙側眼類固醇反應",
            "H40.051": "右側眼高眼壓症",
            "H40.053": "雙側眼高眼壓症",
            "H40.059": "未明示側性高眼壓症",
            "H40.1": "原發性開角型青光眼",
            "H40.10X0": "隅角開放性青光眼,未明示期別",
            "H40.11": "原發性開角型青光眼",
            "H40.1210": "右側眼低眼壓性青光眼,未明示期別",
            "H40.1214": "右側眼低眼壓性青光眼,不確定期別",
            "H40.1230": "雙側低眼壓性青光眼,未明示期別",
            "H40.1231": "雙側低眼壓性青光眼,輕度期別",
            "H40.1232": "雙側低眼壓性青光眼,中度期別",
            "H40.1234": "雙側低眼壓性青光眼,不確定期別",
            "H40.1290": "未明示側性低眼壓性青光眼,未明示期別",
            "H40.1294": "未明示側性低眼壓性青光眼,不確定期別",
            "H40.2": "原發性閉角型青光眼",
            "H40.20X1": "原發性隅角閉鎖性青光眼,輕度期別",
            "H40.2210": "右側眼慢性隅角閉鎖性青光眼,未明示期別",
            "H40.2213": "右側眼慢性隅角閉鎖性青光眼,嚴重期別",
            "H40.2214": "右側眼慢性隅角閉鎖性青光眼,不確定期別",
            "H40.2223": "左側眼慢性隅角閉鎖性青光眼,嚴重期別",
            "H40.2230": "雙側慢性隅角閉鎖性青光眼,未明示期別",
            "H40.2232": "雙側慢性隅角閉鎖性青光眼,中度期別",
            "H40.2290": "未明示側性慢性隅角閉鎖性青光眼,未明示期別",
            "H40.2293": "未明示側性慢性隅角閉鎖性青光眼,嚴重期別",
            "H40.40X0": "未明示側性續發於眼發炎之青光眼,未明示期別",
            "H40.41X0": "右側眼續發於眼發炎之青光眼,未明示期別",
            "H40.43X2": "雙側續發於眼發炎之青光眼,中度期別",
            "H40.53X3": "雙側續發於其他眼疾患之青光眼,嚴重期別",
            "H40.9": "青光眼",
            "H43.1": "玻璃體出血",
            "H43.10": "未明示側性玻璃體出血",
            "H43.11": "右側眼玻璃體出血",
            "H43.12": "左側眼玻璃體出血",
            "H43.20": "未明示側性玻璃體結晶沈澱",
            "H43.23": "雙側玻璃體結晶沈澱",
            "H43.3": "玻璃體膜混濁",
            "H43.391": "右側眼其他玻璃體混濁",
            "H43.392": "左側眼其他玻璃體混濁",
            "H43.393": "雙側其他玻璃體混濁",
            "H43.399": "未明示側性其他玻璃體混濁",
            "H43.811": "右側眼玻璃體退化",
            "H43.813": "雙側玻璃體退化",
            "H43.819": "未明示側性玻璃體退化",
            "H44.0": "化膿性眼內炎",
            "H44.009": "未明示側性化膿性眼內炎",
            "H44.111": "右側眼全葡萄膜炎",
            "H44.112": "左側眼全葡萄膜炎",
            "H44.119": "未明示側性全葡萄膜炎",
            "H44.89": "其他眼球疾患",
            "H44.9": "眼球疾患",
            "H46.3": "毒性視神經病變",
            "H46.8": "其他視神經炎",
            "H46.9": "視神經炎",
            "H47.011": "右側眼缺血性視神經病變",
            "H47.019": "未明示側性缺血性視神經病變",
            "H47.091": "右側眼視神經之其他疾患,他處未歸類者",
            "H47.099": "未明示側性視神經之其他疾患,他處未歸類者",
            "H47.10": "視神經乳頭水腫",
            "H47.20": "視神經萎縮",
            "H47.213": "雙側原發性視神經萎縮",
            "H47.22": "遺傳性視神經萎縮",
            "H47.293": "雙側其他視神經萎縮",
            "H47.49": "與其他疾患有關之視交叉疾患",
            "H47.649": "未明示側性與血管疾患有關之視皮質疾患",
            "H47.9": "視路之疾患",
            "H49.01": "右側眼第三對腦神經(動眼)麻痺",
            "H49.10": "未明示側性第四對腦神經(滑車)麻痺",
            "H49.20": "未明示側性第六對腦神經(外展)麻痺",
            "H49.22": "左側眼第六對腦神經(外展)麻痺",
            "H50.00": "內斜視",
            "H50.05": "交替性內斜視",
            "H50.10": "外斜視",
            "H51.9": "雙側眼運動疾患",
            "H52.00": "未明示側性遠視",
            "H52.10": "未明示側性近視",
            "H52.13": "雙側近視",
            "H52.203": "雙側散光",
            "H52.209": "未明示側性散光",
            "H52.521": "右側眼調節作用麻痺",
            "H52.6": "其他屈光疾患",
            "H52.7": "屈光疾患",
            "H53.001": "右側眼弱視",
            "H53.003": "雙側弱視",
            "H53.009": "未明示側性弱視",
            "H53.029": "未明示側性屈光性弱視",
            "H53.143": "雙側視覺不適",
            "H53.149": "視覺不適,未明示",
            "H53.2": "複視",
            "H53.40": "視野缺損",
            "H53.50": "色覺不足",
            "H53.9": "視覺障礙",
            "H54.0": "雙側眼失明",
            "H55.00": "眼球震顫",
            "H57.8": "眼睛及附屬器官的其他特定之疾患",
            "H57.9": "眼睛及附屬器官疾患",
            "H60.03": "雙側外耳膿瘍",
            "H61.20": "未明示側性耳垢嵌塞",
            "H61.23": "雙側耳垢嵌塞",
            "H66.90": "未明示側性中耳炎",
            "H66.93": "雙側中耳炎",
            "H69.80": "未明示側性其他特定之耳咽管疾患",
            "H81.02": "左側耳梅尼爾氏病",
            "H81.09": "未明示側性之梅尼爾氏病",
            "H90.3": "雙側感音神經性聽力損失",
            "H91.20": "未明示側性之突發性自發性聽力喪失",
            "H91.21": "右側耳突發性自發性聽力喪失",
            "H91.90": "未明示側性之聽障",
            "H91.92": "左側耳聽障",
            "H93.11": "右側耳耳鳴",
            "H93.12": "左側耳耳鳴",
            "H93.13": "雙側耳鳴",
            "H93.19": "未明示側性之耳鳴",
            "H93.92": "左側耳疾患",
            "I11.9": "高血壓性心臟病,無心臟衰竭",
            "I20.8": "其他形式之心絞痛",
            "I25.119": "自體的冠狀動脈粥樣硬化心臟病伴有未明示心絞痛",
            "I25.2": "陳舊性心肌梗塞",
            "I25.700": "未明示冠狀動脈繞道術的動脈粥樣硬化症伴有不穩定心絞痛",
            "I25.9": "慢性缺血性心臟病",
            "I27.0": "原發性肺性高血壓",
            "I27.2": "其他續發性肺性高血壓",
            "I34.1": "非風濕性二尖瓣脫垂",
            "I48.0": "陣發性心房顫動",
            "I49.9": "心臟節律不整",
            "I50.23": "急慢性收縮性(充血性)心臟衰竭",
            "I51.9": "心臟疾病",
            "I60.12": "左側大腦中動脈非創傷性蜘蛛網膜下腔出血",
            "I61.8": "其他非創傷性腦出血",
            "I63.09": "源於其他腦前動脈血栓之腦梗塞",
            "I67.1": "腦動脈瘤,未破裂者",
            "I67.5": "腦部小血管雲霧狀疾病",
            "I69.10": "未明示非創傷性腦出血後遺症",
            "I69.254": "左側非優勢側偏癱/輕偏癱,非創傷性顱內出血後遺症",
            "I69.30": "腦梗塞後遺症",
            "I69.80": "其它腦血管疾病後遺症",
            "I71.010": "升主動脈剝離",
            "I73.00": "Raynaud氏徵候群未伴有壞疽",
            "I88.9": "非特定性淋巴腺炎",
            "I89.8": "其他特定非感染性之淋巴管及淋巴結疾患",
            "J00": "急性鼻咽炎（感冒）",
            "J01.90": "急性鼻竇炎",
            "J02.9": "急性咽炎",
            "J05.10": "急性會厭炎,未伴有阻塞",
            "J18.9": "肺炎,未明示病原體",
            "J20.9": "急性支氣管炎",
            "J30.0": "血管舒縮性鼻炎",
            "J30.2": "其他季節性過敏性鼻炎",
            "J30.5": "食物所致之過敏性鼻炎",
            "J30.89": "其他過敏性鼻炎",
            "J30.9": "過敏性鼻炎",
            "J31.0": "慢性鼻炎",
            "J31.1": "慢性鼻咽炎",
            "J31.2": "慢性咽炎",
            "J32.8": "其他慢性鼻竇炎",
            "J32.9": "慢性鼻竇炎",
            "J35.01": "慢性扁桃腺炎",
            "J35.1": "扁桃腺肥大",
            "J38.3": "聲帶之其他疾病",
            "J38.7": "喉部之其他疾病",
            "J40": "支氣管炎,未明示急性或慢性者",
            "J42": "慢性支氣管炎",
            "J43.9": "肺氣腫",
            "J44.9": "慢性阻塞性肺病",
            "J45.30": "輕度持續性氣喘,無併發症",
            "J45.42": "中度持續性氣喘併氣喘積重狀態",
            "J45.52": "重度持續發作性氣喘併氣喘積重狀態",
            "J45.909": "氣喘,無併發症",
            "J45.998": "其他氣喘",
            "J47.9": "支氣管擴張症",
            "K05.5": "其他牙周疾病",
            "K05.6": "牙周疾病",
            "K06.1": "牙齦腫大",
            "K06.9": "牙齦及無齒性齒槽骨的疾患",
            "K11.20": "唾液腺炎",
            "K12.0": "復發性口瘡",
            "K12.1": "其他類型口腔炎",
            "K12.30": "口腔黏膜炎（潰瘍性)",
            "K13.0": "唇部疾病",
            "K13.70": "口腔黏膜的病灶",
            "K14.0": "舌炎",
            "K14.6": "舌痛",
            "K21.0": "胃食道逆流性疾病併食道炎",
            "K21.00": "胃食道逆流性疾病伴有食道炎未伴有出血",
            "K25.9": "胃潰瘍,未明示急性或慢性,未伴有出血或穿孔",
            "K26.4": "慢性或未明示十二指腸潰瘍併出血",
            "K26.9": "十二指腸潰瘍,未明示急性或慢性,未伴有出血或穿孔",
            "K27.9": "消化性潰瘍,部位未明示,未明示急性或慢性,未伴有出血或穿孔",
            "K30": "功能性消化不良",
            "K31.89": "胃及十二指腸其他的疾病",
            "K31.9": "胃及十二指腸疾病",
            "K51.911": "潰瘍性結腸炎併直腸出血",
            "K55.8": "其他腸血管性疾患",
            "K57.92": "腸憩室炎,未明示部位,未伴有穿孔或膿瘍無出血",
            "K58.0": "激躁性腸症候群併腹瀉",
            "K58.9": "激躁性腸症候群未伴有腹瀉",
            "K59.00": "便秘",
            "K59.1": "功能性腹瀉",
            "K64.9": "痔瘡",
            "K74.60": "肝硬化",
            "K76.0": "脂肪肝(變化),他處未歸類者",
            "K80.33": "膽管結石併急性膽管炎併阻塞",
            "K81.9": "膽囊炎",
            "K87": "歸類於他處疾病所致之膽囊、膽道及胰臟疾患",
            "K92.9": "消化系統疾病,未明示",
            "L02.92": "癤",
            "L03.119": "肢體未明示部位蜂窩組織炎",
            "L11.0": "後天性毛囊角化症",
            "L12.9": "類天疱瘡",
            "L13.0": "疱疹樣皮膚炎",
            "L20.9": "異位性皮膚炎",
            "L21.9": "脂漏性皮膚炎",
            "L23.9": "過敏性接觸性皮膚炎,未明示原因",
            "L25.9": "接觸性皮膚炎,未明示原因",
            "L29.9": "搔癢症",
            "L30.1": "發汗異常(汗皰疹)",
            "L30.2": "皮膚自體敏感作用",
            "L30.8": "其他特定皮膚炎",
            "L30.9": "皮膚炎",
            "L40.0": "尋常性乾癬",
            "L50.0": "過敏性蕁麻疹",
            "L50.9": "蕁麻疹",
            "L65.0": "休止期落髮",
            "L70.0": "尋常性痤瘡",
            "L70.2": "痘瘡樣痤瘡",
            "L70.8": "其他痤瘡",
            "L70.9": "痤瘡",
            "L73.8": "其他特定毛囊疾患",
            "L73.9": "毛囊疾患",
            "L74.512": "手掌原發性局部多汗症",
            "L74.519": "原發性局部多汗症",
            "L95.0": "青斑狀血管炎",
            "M05.70": "未明示部位類風濕性關節炎伴有類風濕因子,未侵及器官及系統",
            "M06.4": "發炎性多關節病變",
            "M06.9": "類風濕性關節炎",
            "M10.9": "痛風",
            "M17.0": "膝部原發性骨關節炎,雙側性",
            "M17.11": "右側膝部原發性骨關節炎,單側性",
            "M17.9": "膝部骨關節炎",
            "M19.90": "未明示部位骨關節炎",
            "M25.50": "關節痛",
            "M25.511": "右側肩部關節痛",
            "M25.521": "右側肘部關節痛",
            "M25.531": "右側腕部關節痛",
            "M25.559": "未明示側性髖部關節痛",
            "M25.561": "右側膝部關節痛",
            "M25.562": "左側膝部關節痛",
            "M25.569": "未明示側性膝部關節痛",
            "M25.571": "右側踝部及足部關節痛",
            "M26.62": "顳頷關節痛",
            "M31.30": "Wegener’s肉芽腫無侵及(侵犯、涉及)腎臟",
            "M32.9": "全身性紅斑性狼瘡",
            "M33.90": "皮多肌炎侵及(侵犯、涉及)器官",
            "M34.9": "全身性硬化症",
            "M35.00": "sjogren’s症候群",
            "M35.01": "sjogren’s症候群伴有角膜結膜炎",
            "M35.09": "sjogren’s徵候群伴有侵及(侵犯、涉及)其他器官",
            "M35.2": "Behcet’s病",
            "M41.9": "脊椎側彎",
            "M43.16": "腰椎脊椎滑脫症",
            "M43.8X4": "胸椎其他特定變形性背部病變",
            "M45.0": "脊椎多部位僵直性脊椎炎",
            "M45.8": "薦骨及薦尾部僵直性脊椎炎",
            "M45.9": "未明示部位脊椎僵直性脊椎炎",
            "M48.02": "頸椎脊椎狹窄症",
            "M51.26": "其他腰椎椎間盤移位",
            "M53.1": "頸臂症候群",
            "M54.2": "頸椎痛",
            "M54.30": "未明示側性坐骨神經痛",
            "M54.50": "下背痛",
            "M54.9": "背痛",
            "M79.2": "神經痛及神經炎",
            "N13.30": "腎水腫",
            "N18.3": "第三期慢性腎臟疾病(中度)",
            "N18.4": "第四期慢性腎臟疾病(重度)",
            "N18.6": "末期腎疾病",
            "N20.0": "腎結石",
            "N34.2": "其他尿道炎",
            "N39.44": "夜間遺尿",
            "N39.8": "其他特定之泌尿系統疾患",
            "N40.0": "良性攝護腺增生未伴有下泌尿道症狀",
            "N40.1": "良性攝護腺增生伴有下泌尿道症狀",
            "N43.3": "陰囊水腫",
            "N60.22": "左側乳房纖維腺病",
            "N61": "乳房炎性疾患",
            "N63": "乳房腫塊",
            "N64.89": "其他特定乳房疾患",
            "N71.1": "慢性子宮炎性疾病",
            "N73.9": "女性骨盆炎性疾病",
            "N76.89": "陰道及女外陰其他特定炎症",
            "N80.0": "子宮體之子宮內膜異位症",
            "N80.00": "子宮內膜異位症",
            "N80.9": "子宮內膜異位症",
            "N89.8": "陰道其他特定非炎性疾患",
            "N91.2": "無月經",
            "N91.5": "月經過少",
            "N92.0": "月經量過多及次數過多伴有規則週期",
            "N92.1": "月經量過多及次數過多伴有不規則週期",
            "N92.3": "排卵出血",
            "N92.5": "其他特定月經不規則",
            "N92.6": "月經不規則",
            "N93.9": "子宮及陰道異常出血",
            "N94.3": "月經前緊張症候群",
            "N94.5": "續發性痛經症",
            "N94.6": "痛經症",
            "N95.1": "停經及女性更年期之病況",
            "N95.9": "停經及停經前後之疾患",
            "N97.9": "女性不孕",
            "O03.4": "不完全自然流產未伴有併發症",
            "O12.00": "妊娠性水腫,未明示妊娠期",
            "O14.02": "輕度至中度子癇前症,妊娠第二期",
            "O20.8": "其他早期妊娠出血",
            "O20.9": "早期妊娠出血",
            "O21.9": "妊娠嘔吐",
            "Q12.0": "先天性白內障",
            "Q15.0": "先天性青光眼",
            "Q28.2": "腦血管動靜脈畸形",
            "Q43.1": "Hirschsprung氏症",
            "R00.2": "心悸",
            "R04.0": "鼻出血",
            "R04.2": "咳血",
            "R05": "咳嗽",
            "R05.8": "其他明示咳嗽",
            "R05.9": "咳嗽",
            "R06.00": "呼吸困難",
            "R06.1": "喘鳴",
            "R06.2": "哮鳴",
            "R06.6": "打嗝",
            "R06.7": "打噴嚏",
            "R07.0": "喉嚨痛",
            "R07.9": "胸痛",
            "R09.81": "鼻塞",
            "R09.82": "鼻涕倒流",
            "R10.83": "腹絞痛",
            "R10.9": "腹痛",
            "R11.10": "嘔吐",
            "R14.1": "氣脹痛",
            "R14.2": "噯氣",
            "R14.3": "胃腸脹氣",
            "R19.7": "腹瀉",
            "R25.2": "痛性痙攣及痙攣",
            "R30.0": "排尿困難",
            "R30.9": "排尿疼痛",
            "R35.0": "頻尿",
            "R42": "頭暈及目眩",
            "R43.1": "嗅覺倒錯",
            "R43.2": "味覺倒錯",
            "R43.9": "嗅覺及味覺障礙",
            "R49.0": "發聲困難",
            "R50.9": "發燒",
            "R51": "頭痛",
            "R51.9": "頭痛",
            "R53.1": "虛弱",
            "R53.81": "其他之乏力",
            "R53.82": "慢性疲勞",
            "R53.83": "其他疲勞",
            "R59.9": "淋巴結腫大",
            "R60.9": "水腫",
            "R61": "全身性多汗症",
            "R62.50": "兒童期生理發育不符正常預期",
            "R62.52": "身材短小(兒童)",
            "R68.2": "口乾",
            "R94.120": "聽力功能檢查結果異常",
            "S00.11XS": "右側眼瞼及眼周圍區域挫傷之後遺症",
            "S00.83XD": "頭部其他部位挫傷之後續照護",
            "S02.3XXG": "眶底骨折延遲癒合之後續照護",
            "S04.019S": "未明示側性視神經損傷之後遺症",
            "S04.031S": "右眼視徑及視路損傷之後遺症",
            "S04.21XD": "右側滑車神經損傷之後續照護",
            "S05.01XS": "右側眼結膜及角膜損傷未伴有異物之後遺症",
            "S05.10XA": "未明示側性眼球及眼眶組織挫傷之初期照護",
            "S05.10XD": "未明示側性眼球及眼眶組織挫傷之後續照護",
            "S05.10XS": "未明示側性眼球及眼眶組織挫傷之後遺症",
            "S05.12XS": "左側眼球及眼眶組織挫傷之後遺症",
            "S05.22XS": "左側眼撕裂傷及破裂伴有眼內組織脫出或損失之後遺症",
            "S05.30XS": "未明示側性眼撕裂傷未伴有眼內組織脫出或損失之後遺症",
            "S05.8X1S": "右側眼及眼眶其他損傷之後遺症",
            "S05.8X9S": "未明示側性眼及眼眶其他損傷之後遺症",
            "S05.92XS": "左側眼及眼眶損傷之後遺症",
            "S06.300S": "局部腦損傷,未伴有意識喪失之後遺症",
            "S06.5X0S": "創傷性硬腦膜下出血,未伴有意識喪失之後遺症",
            "S06.6X0S": "創傷性蜘蛛網膜下出血,未伴有意識喪失之後遺症",
            "T07": "多處損傷",
            "T67.0XXA": "熱中暑及日中暑之初期照護",
            "T67.0XXS": "熱中暑及日中暑之後遺症",
            "U07.1": "嚴重特殊傳染性肺炎",
            "U09.9": "嚴重特殊傳染性肺炎後的病況",
            "Z94.1": "心臟移植狀態"
        };

        const IconWrapper = ({ children, className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>;
        const Printer = ({ className }) => <IconWrapper className={className}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect x="6" y="14" width="12" height="8"/></IconWrapper>;
        const Syringe = ({ className }) => <IconWrapper className={className}><path d="m18 2 4 4"/><path d="m17 7 3-3"/><path d="M19 9 8.7 19.3c-1 1-2.5 1-3.4 0l-.6-.6c-1-1-1-2.5 0-3.4L15 5"/><path d="m9 11 4 4"/><path d="m5 19-3 3"/><path d="m14 4 6 6"/></IconWrapper>;
        const User = ({ className }) => <IconWrapper className={className}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></IconWrapper>;
        const RefreshIcon = ({ className }) => <IconWrapper className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></IconWrapper>;

        function App() {
            const DEFAULT_TEXT = `病名：H04.123
醫師：林佑彥  自費  (內)  [      -]
脈象：左寸促關尺滑,右寸促關弦尺滑
用藥：2 x14/1天2次    
處方：柴胡(自)(?1.5錢  黃芩(自)(?1.5錢  薑半夏(自) 1.0錢
      山梔子(自) 0.5錢  茵陳蒿(自) 0.5錢  夏枯草(自) 1.0錢
      龍膽草(自) 0.5錢  枳實(自)(?0.5錢  烏藥(自)(?1.0錢
      遠志(自)(?1.0錢  石菖蒲(自) 0.5錢  蓮子心(自) 0.5錢
      乾薑(自)(?1.0錢  黨參(自)(?1.0錢  土炒白朮(?1.0錢
      雲茯苓(自) 1.0錢  葛根(自)(?1.0錢  桑寄生(自) 1.0錢
      旱蓮草(自) 1.0錢  地骨皮(自) 1.0錢  牡丹皮(自) 1.0錢
      細辛(自)(?0.5錢  生甘草(自) 1.0錢  紅大棗(自) 1.0錢
      酒大黃(自) 1.0錢  飲片代煎費 1.0天  飲片代寄運 1.0`;

            const [rawText, setRawText] = useState(DEFAULT_TEXT);
            const [patientName, setPatientName] = useState("");
            const [visitDate, setVisitDate] = useState(new Date().toISOString().split('T')[0]);
            const [pulse, setPulse] = useState("");
            const [diagnosis, setDiagnosis] = useState("");
            const [medicationInfo, setMedicationInfo] = useState("");
            const [isSyncing, setIsSyncing] = useState(false);
            const [parsedData, setParsedData] = useState({ medicines: [], others: [] });
            
            // 自動偵測是否需要代煎/寄送
            const needsDelivery = /代煎|寄運|代寄/i.test(rawText);

            const handleSyncICD = async () => {
                let match = diagnosis.match(/[A-Za-z]\d{2}(?:\.[A-Za-z0-9]+)?/);
                
                // 容錯處理：如果輸入沒有小數點 (如 H04123)，嘗試在第三位後加上小數點再比對
                if (!match) {
                    const noDotMatch = diagnosis.match(/([A-Za-z]\d{2})(\d+)/);
                    if (noDotMatch) {
                        match = [`${noDotMatch[1]}.${noDotMatch[2]}`];
                    } else {
                        const baseMatch = diagnosis.match(/([A-Za-z]\d{2})/);
                        if (baseMatch) {
                            match = [baseMatch[1]];
                        } else {
                            alert("請先輸入有效的 ICD-10 代碼 (例如: H04.123 或 E11.9)");
                            return;
                        }
                    }
                }

                const code = match[0].toUpperCase();
                setIsSyncing(true);

                try {
                    if (LOCAL_ICD_DICT[code]) {
                        setDiagnosis(`${code} ${LOCAL_ICD_DICT[code]}`);
                        setIsSyncing(false);
                        return;
                    }

                    const res = await fetch(`https://clinicaltables.nlm.nih.gov/api/icd10cm/v3/search?terms=${code}`);
                    const data = await res.json();

                    if (data[0] > 0) {
                        const fetchedCode = data[3][0][0];
                        const fetchedNameEn = data[3][0][1];
                        
                        try {
                            const transRes = await fetch(`https://api.mymemory.translated.net/get?q=${encodeURIComponent(fetchedNameEn)}&langpair=en|zh-TW`);
                            const transData = await transRes.json();
                            const fetchedNameZh = transData.responseData.translatedText;
                            
                            if(fetchedNameZh && !fetchedNameZh.includes("MYMEMORY")) {
                                setDiagnosis(`${fetchedCode} ${fetchedNameZh}`);
                            } else {
                                setDiagnosis(`${fetchedCode} ${fetchedNameEn}`);
                            }
                        } catch (translateError) {
                            setDiagnosis(`${fetchedCode} ${fetchedNameEn}`);
                        }
                    } else {
                        alert(`線上資料庫找不到代碼：${code}`);
                    }
                } catch (error) {
                    console.error("同步失敗:", error);
                    alert("同步失敗，請檢查網路連線。");
                } finally {
                    setIsSyncing(false);
                }
            };

            const parsePrescription = (text) => {
                const medicines = [];
                const others = [];

                const pulseMatch = text.match(/脈[象診]?\s*[:：]\s*([^\s\n]+)/);
                if (pulseMatch) {
                    setPulse(pulseMatch[1].trim());
                }

                const dxMatch = text.match(/(?:病名|診斷|ICD(?:-10)?)[^\w\u4e00-\u9fa5]*([A-Za-z]\d{2}(?:\.?[A-Za-z0-9]+)?)([^\n]*)/);
                if (dxMatch) {
                    let code = dxMatch[1].toUpperCase();
                    // 如果沒有小數點但長度大於3，自動補上小數點
                    if (!code.includes('.') && code.length > 3) {
                        code = code.substring(0, 3) + '.' + code.substring(3);
                    }
                    
                    const restOfLine = dxMatch[2].trim();
                    
                    if (LOCAL_ICD_DICT[code] && !restOfLine.includes(LOCAL_ICD_DICT[code])) {
                        setDiagnosis(`${code} ${LOCAL_ICD_DICT[code]}`);
                    } else {
                        setDiagnosis(`${code} ${restOfLine}`.trim());
                    }
                }

                const medMatch = text.match(/用藥：.*?([Xx])\s*(\d+)\s*\/\s*1天\s*(\d+)\s*次/i);
                if (medMatch) {
                    const days = medMatch[2];
                    const times = medMatch[3];
                    let timeStr = `每日${times}次`;
                    if (times === "2") timeStr = "早晚服用";
                    if (times === "3") timeStr = "三餐服用";
                    setMedicationInfo(`${days}天份，${timeStr}`);
                } else {
                    setMedicationInfo("");
                }

                let cleanText = text.replace(/醫師：.*?\n/, '') 
                                    .replace(/用藥：.*?\n/, '') 
                                    .replace(/處方：/, '');    

                const regex = /([\u4e00-\u9fa5]+)(?:[\(\)自\?\[\]\s]*?)(\d+(?:\.\d+)?)(?:[錢天次g克])?/g;
                const matches = [...cleanText.matchAll(regex)];

                const excludeItems = ["代煎", "寄運", "處方籤", "處方簽", "調劑", "掛號"];

                matches.forEach(match => {
                    const name = match[1];
                    const dose = match[2];
                    
                    if (["錢", "天", "次", "克", "公克", "日", "帖"].includes(name)) return;
                    if (excludeItems.some(ex => name.includes(ex))) return;

                    let unit = "錢"; 
                    if (name.includes("天")) unit = "天";
                    else if (name.includes("次")) unit = "次";

                    medicines.push({ name_zh: name, dosage: dose, unit: "錢" });
                });

                setParsedData({ medicines, others });
            };

            useEffect(() => {
                parsePrescription(rawText);
            }, [rawText]);

            const displayDiagnosis = diagnosis.replace(/^[A-Za-z]\d{2}(?:\.[A-Za-z0-9]+)?\s*/, '');

            return (
                <div className="min-h-screen pb-10 flex flex-col md:flex-row font-hei text-sm md:text-base">
                    
                    {/* 左側：輸入區 */}
                    <div className="w-full md:w-1/3 p-6 bg-slate-800 text-white overflow-y-auto h-screen sticky top-0 no-print z-10">
                        <h1 className="text-2xl font-bold mb-6 flex items-center text-teal-400">
                            <Syringe className="mr-2" /> 個人處方生成器
                        </h1>

                        <div className="space-y-6">
                            <div className="bg-slate-700 p-4 rounded-lg border border-slate-600">
                                <h2 className="font-bold mb-3 flex items-center text-teal-300"><User className="w-4 h-4 mr-2"/> 1. 患者資訊</h2>
                                <div className="space-y-3">
                                    <div className="grid grid-cols-2 gap-3">
                                        <div>
                                            <label className="block text-xs text-slate-400 mb-1">患者姓名</label>
                                            <input 
                                                type="text" 
                                                value={patientName}
                                                onChange={(e) => setPatientName(e.target.value)}
                                                placeholder="請輸入姓名..."
                                                className="w-full bg-slate-900 border border-slate-500 rounded p-2 text-white focus:border-teal-500 outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs text-slate-400 mb-1">開立日期</label>
                                            <input 
                                                type="date" 
                                                value={visitDate}
                                                onChange={(e) => setVisitDate(e.target.value)}
                                                className="w-full bg-slate-900 border border-slate-500 rounded p-2 text-white focus:border-teal-500 outline-none"
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs text-slate-400 mb-1">病名 (輸入代碼後可自動翻譯)</label>
                                        <div className="flex">
                                            <input 
                                                type="text" 
                                                value={diagnosis}
                                                onChange={(e) => setDiagnosis(e.target.value)}
                                                onKeyDown={(e) => { if(e.key === 'Enter') handleSyncICD(); }}
                                                placeholder="輸入代碼如 H04.123 或 H04123"
                                                className="w-full bg-slate-900 border border-slate-500 rounded-l p-2 text-white focus:border-teal-500 outline-none"
                                            />
                                            <button 
                                                onClick={handleSyncICD}
                                                disabled={isSyncing}
                                                className="bg-teal-600 hover:bg-teal-500 text-white px-3 rounded-r border border-teal-600 flex items-center justify-center transition-colors"
                                                title="從線上庫同步並翻譯病名"
                                            >
                                                {isSyncing ? <RefreshIcon className="w-4 h-4 animate-spin" /> : <RefreshIcon className="w-4 h-4" />}
                                            </button>
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-xs text-slate-400 mb-1">脈象</label>
                                        <input 
                                            type="text" 
                                            value={pulse}
                                            onChange={(e) => setPulse(e.target.value)}
                                            placeholder="例如：弦滑"
                                            className="w-full bg-slate-900 border border-slate-500 rounded p-2 text-white focus:border-teal-500 outline-none"
                                        />
                                    </div>
                                </div>
                            </div>

                            <div className="bg-slate-700 p-4 rounded-lg border border-slate-600">
                                <h2 className="font-bold mb-3 flex items-center text-teal-300">2. 貼上病歷摘要</h2>
                                <textarea 
                                    value={rawText}
                                    onChange={(e) => setRawText(e.target.value)}
                                    className="w-full h-48 bg-slate-900 border border-slate-500 rounded p-2 text-xs font-mono text-gray-300 focus:border-teal-500 outline-none leading-relaxed"
                                    spellCheck="false"
                                    placeholder="請貼上包含處方的文字..."
                                ></textarea>
                                <div className="mt-2 flex justify-between items-center text-xs text-slate-400 border-t border-slate-600 pt-2">
                                    <span>藥材：{parsedData.medicines.length} 味</span>
                                    {medicationInfo && <span className="text-teal-300">{medicationInfo}</span>}
                                </div>
                            </div>

                            <button 
                                onClick={() => window.print()} 
                                className="w-full py-3 bg-teal-600 hover:bg-teal-500 text-white font-bold rounded-lg shadow-lg flex items-center justify-center transition-all"
                            >
                                <Printer className="mr-2" /> 列印 / 另存 PDF
                            </button>
                        </div>
                    </div>

                    {/* 右側：預覽區 */}
                    <div className="w-full md:w-2/3 bg-gray-200 p-2 md:p-8 flex justify-center overflow-y-auto">
                        
                        {/* A4 紙張本體 */}
                        <div id="print-area" className="bg-white shadow-xl w-[210mm] h-[297mm] p-8 md:p-10 relative flex flex-col text-black box-border overflow-hidden">
                            
                            {/* --- 頂部標題區 --- */}
                            <div className="text-center mb-6 pt-2 border-b-2 border-gray-800 pb-3 flex-shrink-0">
                                <div className="flex justify-center items-baseline flex-wrap gap-x-4 gap-y-1">
                                    <h1 className="text-2xl md:text-[28px] font-ming font-bold tracking-[0.1em] text-gray-900">
                                        {CLINIC_INFO.physician} 中醫水煎藥處方箋
                                    </h1>
                                    <p className="text-base font-ming text-gray-600 tracking-wider">
                                        TCM Herbal Prescription
                                    </p>
                                </div>
                            </div>

                            {/* --- I. Patient Info --- */}
                            <div className="mb-4 font-ming flex-shrink-0">
                                <h3 className="font-bold text-sm text-gray-800 mb-2 border-b border-gray-300 pb-1">一、患者資訊</h3>
                                <div className="grid grid-cols-2 gap-x-8 gap-y-1 text-sm">
                                    {/* 第一行：姓名與日期 */}
                                    <div className="flex justify-between py-1 border-b border-gray-100">
                                        <span className="font-semibold text-gray-600 shrink-0">姓名：</span>
                                        <span className="font-bold text-base text-right">{patientName}</span>
                                    </div>
                                    <div className="flex justify-between py-1 border-b border-gray-100">
                                        <span className="font-semibold text-gray-600 shrink-0">開立日期：</span>
                                        <span className="font-mono text-base text-right">{visitDate}</span>
                                    </div>
                                    
                                    {/* 第二行：脈象 */}
                                    <div className="col-span-2 flex py-1 border-b border-gray-100">
                                        <span className="font-semibold text-gray-600 w-20 shrink-0">脈象：</span>
                                        <span className="font-bold text-base flex-1">{pulse}</span>
                                    </div>
                                    
                                    {/* 第三行：病名 */}
                                    <div className="col-span-2 flex py-1 border-b border-gray-100">
                                        <span className="font-semibold text-gray-600 w-20 shrink-0">病名：</span>
                                        <span className="font-bold text-base flex-1">{displayDiagnosis}</span>
                                    </div>
                                </div>
                            </div>

                            {/* --- II. Prescription --- */}
                            <div className="flex-1 font-ming flex flex-col overflow-hidden">
                                <h3 className="font-bold text-sm text-gray-800 mb-2 border-b border-gray-300 pb-1 flex-shrink-0">二、處方明細</h3>
                                
                                <div className="flex justify-between items-end mb-2 flex-shrink-0">
                                    <h4 className="font-bold text-sm text-gray-700">【內服水煎藥】</h4>
                                </div>

                                <div className="grid grid-cols-3 gap-x-6 gap-y-2 content-start border-t-2 border-gray-800 pt-4 flex-1 overflow-hidden">
                                    {parsedData.medicines.map((item, i) => (
                                        <div key={i} className="flex justify-between items-baseline border-b border-dashed border-gray-300 py-1.5 px-1">
                                            <span className="text-base font-bold text-gray-900 tracking-wide leading-relaxed">
                                                {item.name_zh}
                                            </span>
                                            <span className="text-sm font-mono font-bold text-gray-800 leading-relaxed">
                                                {item.dosage} <span className="text-xs font-normal text-gray-600">錢</span>
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            {/* --- 天數、總計與代煎手寫欄位 --- */}
                            <div className="mt-auto pt-3 border-t border-gray-300 flex flex-col gap-2 flex-shrink-0 font-ming">
                                <div className="flex justify-between items-center">
                                    <div className="text-base font-bold text-gray-800 tracking-wide">
                                        {medicationInfo && <span>{medicationInfo}</span>}
                                    </div>
                                    <div>
                                        <span className="text-xs text-gray-500 mr-2">總計藥材：</span>
                                        <span className="font-bold text-lg">{parsedData.medicines.length} <span className="text-xs font-normal text-gray-600">味</span></span>
                                    </div>
                                </div>
                                
                                {/* 觸發條件：當病歷摘要有代煎、寄送字眼時，自動顯示行政手寫欄位 */}
                                {needsDelivery && (
                                    <div className="flex justify-between items-center pt-2 mt-1 border-t border-dashed border-gray-200">
                                        <span className="text-xs text-gray-500 italic">※ 此處方含代煎 / 代寄運服務</span>
                                        <div>
                                            <span className="text-sm font-bold text-gray-700 mr-2">預計出貨 / 寄送日期：</span>
                                            <span className="inline-block w-36 border-b border-gray-500 align-text-bottom"></span>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* --- III. Footer 醫囑與診所資訊 --- */}
                            <div className="pt-4 border-t-2 border-gray-800 font-hei flex-shrink-0">
                                <div className="flex justify-between items-end mb-4">
                                    <div className="text-left w-2/3 pr-2">
                                        <p className="text-xs font-bold text-gray-700 mb-1">醫師叮嚀：</p>
                                        <p className="text-xs text-gray-600 leading-relaxed">
                                            1. 藥物僅輔助疏通，療效關鍵仍在您的生活作息與情緒。<br/>
                                            2. 放下對數據的執著，治療終點在找回生活品質與平靜。<br/>
                                            3. 服藥期間若有任何不適，請先停藥，並於回診時討論。
                                        </p>
                                    </div>
                                    <div className="w-1/3 text-right">
                                        <div className="inline-block text-center">
                                            <div className="mb-1 relative">
                                                {/* 蓋章區 */}
                                                <div className="w-16 h-16 border border-red-300 rounded-full absolute -top-4 left-1/2 transform -translate-x-1/2 opacity-30 flex items-center justify-center">
                                                    <span className="text-red-300 text-[10px] transform -rotate-12">醫師章</span>
                                                </div>
                                                <p className="font-bold text-lg mb-1 border-b border-black pb-1 min-w-[100px] font-ming">
                                                    {CLINIC_INFO.physician}
                                                </p>
                                            </div>
                                            <p className="text-[10px] text-gray-500 mt-1">執照號：{CLINIC_INFO.license}</p>
                                        </div>
                                    </div>
                                </div>

                                {/* 最下方的診所資訊 */}
                                <div className="border-t border-gray-200 pt-2 flex flex-wrap justify-between items-center text-[10px] text-gray-400">
                                    <div className="flex gap-4">
                                        <span className="font-bold text-gray-500">{CLINIC_INFO.nameZh}</span>
                                        <span>電話: {CLINIC_INFO.phone}</span>
                                    </div>
                                    <div>
                                        <span>地址: {CLINIC_INFO.address}</span>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
